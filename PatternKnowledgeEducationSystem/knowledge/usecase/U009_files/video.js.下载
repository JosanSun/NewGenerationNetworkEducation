!function(){var e=UM.dom.domUtils,t="video";UM.registerWidget(t,{tpl:'<link rel="stylesheet" type="text/css" href="<%=video_url%>video.css" /><div class="edui-video-wrapper"><div id="eduiVideoTab"><div id="eduiVideoTabHeads" class="edui-video-tabhead"><span tabSrc="video" class="edui-video-focus"><%=lang_tab_insertV%></span></div><div id="eduiVideoTabBodys" class="edui-video-tabbody"><div id="eduiVideoPanel" class="edui-video-panel"><table><tr><td><label for="eduiVideoUrl" class="edui-video-url"><%=lang_video_url%></label></td><td><input id="eduiVideoUrl" type="text"></td></tr></table><div id="eduiVideoPreview"></div><div id="eduiVideoInfo"><fieldset><legend><%=lang_video_size%></legend><table><tr><td><label for="eduiVideoWidth"><%=lang_videoW%></label></td><td><input class="edui-video-txt" id="eduiVideoWidth" type="text"/></td></tr><tr><td><label for="eduiVideoHeight"><%=lang_videoH%></label></td><td><input class="edui-video-txt" id="eduiVideoHeight" type="text"/></td></tr></table></fieldset><fieldset><legend><%=lang_alignment%></legend><div id="eduiVideoFloat"></div></fieldset></div></div></div></div></div>',initContent:function(e,i){var d=this,o=e.getLang(t),r=UMEDITOR_CONFIG.UMEDITOR_HOME_URL+"dialogs/video/";d.lang=o,d.editor=e,d.$widget=i,d.root().html($.parseTmpl(d.tpl,$.extend({video_url:r},o["static"]))),d.initController(o)},initEvent:function(){var e=this,t=$("#eduiVideoUrl",e.$widget)[0];"oninput"in t?t.oninput=function(){e.createPreviewVideo(this.value)}:t.onpropertychange=function(){e.createPreviewVideo(this.value)}},initController:function(){var t,i=this,d=i.editor.selection.getRange().getClosedNode();if(i.createAlignButton(["eduiVideoFloat"]),d&&"edui-faked-video"==d.className){$("#eduiVideoUrl",i.$widget)[0].value=t=d.getAttribute("_url"),$("#eduiVideoWidth",i.$widget)[0].value=d.width,$("#eduiVideoHeight",i.$widget)[0].value=d.height;var o=e.getComputedStyle(d,"float"),r=e.getComputedStyle(d.parentNode,"text-align");i.updateAlignButton("center"===r?"center":o)}i.createPreviewVideo(t)},createPreviewVideo:function(e){if(e){var t=this,i=t.lang,d=t.convert_url(e);return t.endWith(d,[".swf",".flv",".wmv"])?void($("#eduiVideoPreview",t.$widget)[0].innerHTML='<embed type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" src="'+e+'" width="420" height="280" wmode="transparent" play="true" loop="false" menu="false" allowscriptaccess="never" allowfullscreen="true" ></embed>'):void $("#eduiVideoPreview",t.$widget).html(i.urlError)}},insertSingle:function(){var e=this,t=$("#eduiVideoWidth",e.$widget)[0],i=$("#eduiVideoHeight",e.$widget)[0],d=$("#eduiVideoUrl",e.$widget)[0].value,o=this.findFocus("eduiVideoFloat","name");return d&&e.checkNum([t,i])?void this.editor.execCommand("insertvideo",{url:e.convert_url(d),width:t.value,height:i.value,align:o}):!1},convert_url:function(e){if(!e)return"";var t=e.match(/youtu.be\/(\w+)$/)||e.match(/youtube\.com\/watch\?v=(\w+)/)||e.match(/youtube.com\/v\/(\w+)/),i=e.match(/youku\.com\/v_show\/id_(\w+)/),d=/player\.youku\.com/gi.test(e);return e=d?e.replace(/\?f=.*/,""):t?"https://www.youtube.com/v/"+t[1]+"?version=3&feature=player_embedded":i?"http://player.youku.com/player.php/sid/"+i[1]+"/v.swf":e.replace(/http:\/\/www\.tudou\.com\/programs\/view\/([\w\-]+)\/?/i,"http://www.tudou.com/v/$1").replace(/http:\/\/www\.youtube\.com\/watch\?v=([\w\-]+)/i,"http://www.youtube.com/v/$1").replace(/http:\/\/v\.youku\.com\/v_show\/id_([\w\-=]+)\.html/i,"http://player.youku.com/player.php/sid/$1").replace(/http:\/\/www\.56\.com\/u\d+\/v_([\w\-]+)\.html/i,"http://player.56.com/v_$1.swf").replace(/http:\/\/www.56.com\/w\d+\/play_album\-aid\-\d+_vid\-([^.]+)\.html/i,"http://player.56.com/v_$1.swf").replace(/http:\/\/v\.ku6\.com\/.+\/([^.]+)\.html/i,"http://player.ku6.com/refer/$1/v.swf").replace(/\?f=.*/,"")},checkNum:function(e){for(var t,i=this,d=0;t=e[d++];){var o=t.value;if(!i.isNumber(o)&&o)return alert(i.lang.numError),t.value="",t.focus(),!1}return!0},isNumber:function(e){return/(0|^[1-9]\d*$)/.test(e)},updateAlignButton:function(e){for(var t,i=$("#eduiVideoFloat",this.$widget)[0].children,d=0;t=i[d++];)t.getAttribute("name")==e?"edui-video-focus"!=t.className&&(t.className="edui-video-focus"):"edui-video-focus"==t.className&&(t.className="")},createAlignButton:function(e){for(var t,i=this.lang,d=UMEDITOR_CONFIG.UMEDITOR_HOME_URL+"dialogs/video/",o=0;t=e[o++];){var r=$("#"+t,this.$widget)[0],a={none:i["default"],left:i.floatLeft,right:i.floatRight};for(var l in a){var u=document.createElement("div");u.setAttribute("name",l),"none"==l&&(u.className="edui-video-focus"),u.style.cssText="background:url("+d+"images/"+l+"_focus.jpg);",u.setAttribute("title",a[l]),r.appendChild(u)}this.switchSelect(t)}},switchSelect:function(e){for(var t,i=$("#"+e,this.$widget)[0].children,d=0;t=i[d++];)$(t).on("click",function(){for(var e,t=0;e=i[t++];)e.className="",e.removeAttribute&&e.removeAttribute("class");this.className="edui-video-focus"})},findFocus:function(e,t){for(var i,d,o=$("#"+e,this.$widget)[0].children,r=0;d=o[r++];)if("edui-video-focus"==d.className){i=d.getAttribute(t);break}return i},endWith:function(e,t){for(var i=0,d=t.length;d>i;i++){var o=t[i];if(e.length-o.length<0)return!1;if(e.substring(e.length-o.length)==o)return!0}return!1},width:610,height:498,buttons:{ok:{exec:function(e,i){$("#eduiVideoPreview",i).html(""),e.getWidgetData(t).insertSingle()}},cancel:{exec:function(){$("#eduiVideoPreview").html("")}}}})}();