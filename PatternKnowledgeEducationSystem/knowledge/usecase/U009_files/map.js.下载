!function(){var e="map";UM.registerWidget(e,{tpl:'<style type="text/css">.edui-dialog-map .edui-map-content{width:530px; height: 350px;margin: 10px auto;}.edui-dialog-map .edui-map-content table{width: 100%}.edui-dialog-map .edui-map-content table td{vertical-align: middle;}.edui-dialog-map .edui-map-button { border: 1px solid #ccc; float: left; cursor: default; height: 23px; width: 70px; cursor: pointer; margin: 0; font-size: 12px; line-height: 24px; text-align: center; }.edui-dialog-map .edui-map-button:hover {background:#eee;}.edui-dialog-map .edui-map-city,.edui-dialog-map .edui-map-address{height:21px;background: #FFF;border:1px solid #d7d7d7; line-height: 21px;}.edui-dialog-map .edui-map-city{width:90px}.edui-dialog-map .edui-map-address{width:150px}.edui-dialog-map .edui-map-dynamic-label span{vertical-align:middle;margin: 3px 0px 3px 3px;}.edui-dialog-map .edui-map-dynamic-label input{vertical-align:middle;margin: 3px;}</style><div class="edui-map-content"><table><tr><td><%=lang_city%>:</td><td><input class="edui-map-city" type="text" value="<%=city.value%>"/></td><td><%=lang_address%>:</td><td><input class="edui-map-address" type="text" value="" /></td><td><a class="edui-map-button"><%=lang_search%></a></td><td><label class="edui-map-dynamic-label"><input class="edui-map-dynamic" type="checkbox" name="edui-map-dynamic" /><span><%=lang_dynamicmap%></span></label></td></tr></table><div style="width:100%;height:340px;margin:5px auto;border:1px solid gray" class="edui-map-container"></div></div><script class="edui-tpl-container" type="text/plain"><!DOCTYPE html><html><head><title></title></head><body><scr_ipt>window.onload = function(){var scripts = document.scripts || document.getElementsByTagName("script"),src = [];for( var i = 1, len = scripts.length; i<len; i++ ) {src.push( scripts[i].src );}parent.UM.getEditor(<<id>>).getWidgetData(\'map\').requestMapApi( src );};function mapReadyStateChange ( state ) { '+" if ( state === 'complete' || state === 'loaded' ) { document.close();  } }</scr_ipt><scr_ipt onreadystatechange='mapReadyStateChange(this.readyState);' onload='mapReadyStateChange(\"loaded\");' src=\"http://api.map.baidu.com/api?v=2.0&ak=6b6c1a67eaa7db1ca6d6da28e590e343&services=true\"></scr_ipt></body></html></script>",initContent:function(t){var i=this,a=t.getLang(e),n=t.options.themePath+t.options.theme;return i.inited?(i.preventDefault(),!1):(i.inited=!0,i.lang=a,i.editor=t,i.root().html($.parseTmpl(i.tpl,$.extend({},a["static"],{theme_url:n}))),void i.initRequestApi())},initRequestApi:function(){var e=null;window.BMap&&window.BMap.Map?this.initBaiduMap():(e=$('<iframe style="display: none;"></iframe>'),e.appendTo(this.root()),e=e[0].contentWindow.document,e.open(),e.write(this.root().find(".edui-tpl-container").html().replace(/scr_ipt/g,"script").replace("<<id>>","'"+this.editor.id+"'")))},requestMapApi:function(e){var t=this;if(e.length){var i=e[0];e=e.slice(1),i?$.getScript(i,function(){t.requestMapApi(e)}):t.requestMapApi(e)}else t.initBaiduMap()},initBaiduMap:function(){var e,t,i,a=this.root(),n=new BMap.Map(a.find(".edui-map-container")[0]),d=this,r=$(d.editor.selection.getRange().getClosedNode());if(n.enableInertialDragging(),n.enableScrollWheelZoom(),n.enableContinuousZoom(),r.length&&/api[.]map[.]baidu[.]com/gi.test(r.attr("src"))){var o=r.attr("src"),p=d.getPars(o,"center").split(","),s=d.getPars(o,"markers").split(",");t=new BMap.Point(Number(p[0]),Number(p[1])),e=new BMap.Marker(new BMap.Point(Number(s[0]),Number(s[1]))),n.addControl(new BMap.NavigationControl),n.centerAndZoom(t,Number(d.getPars(o,"zoom"))),i=r.attr("style")}else t=new BMap.Point(116.404,39.915),e=new BMap.Marker(t),n.addControl(new BMap.NavigationControl),n.centerAndZoom(t,10);e.enableDragging(),n.addOverlay(e),d.map=n,d.marker=e,d.imgcss=i},doSearch:function(){var e=this,t=e.root().find(".edui-map-city").val(),i=e.root().find(".edui-map-address").val();if(!t)return void alert(e.lang.cityMsg);var a=new BMap.LocalSearch(t,{onSearchComplete:function(t){if(t&&t.getNumPois()){for(var i=[],a=0;a<t.getCurrentNumPois();a++)i.push(t.getPoi(a).point);i.length>1?e.map.setViewport(i):e.map.centerAndZoom(i[0],13),point=e.map.getCenter(),e.marker.setPoint(point)}else alert(e.lang.errorMsg)}});a.search(i||t)},getPars:function(e,t){var i=new RegExp(t+"=((\\d+|[.,])*)","g");return i.exec(e)[1]},reset:function(){this.map&&this.map.reset()},initEvent:function(){var e=this,t=e.root();t.find(".edui-map-address").on("keydown",function(t){return t=t||event,13==t.keyCode?(e.doSearch(),!1):void 0}),t.find(".edui-map-button").on("click",function(){e.doSearch()}),t.find(".edui-map-address").focus(),t.on("mousewheel DOMMouseScroll",function(){return!1})},width:580,height:408,buttons:{ok:{exec:function(t){var i=t.getWidgetData(e),a=i.map.getCenter(),n=i.map.getZoom(),d=i.map.getSize(),r=i.marker.P;if(i.root().find(".edui-map-dynamic")[0].checked){var o=t.getOpt("UMEDITOR_HOME_URL"),p=[o+(/\/$/.test(o)?"":"/")+"dialogs/map/map.html#center="+a.lng+","+a.lat,"&zoom="+n,"&width="+d.width,"&height="+d.height,"&markers="+r.lng+","+r.lat].join("");t.execCommand("inserthtml",'<iframe class="ueditor_baidumap" src="'+p+'" frameborder="0" width="'+(d.width+4)+'" height="'+(d.height+4)+'"></iframe>')}else p="http://api.map.baidu.com/staticimage?center="+a.lng+","+a.lat+"&zoom="+n+"&width="+d.width+"&height="+d.height+"&markers="+r.lng+","+r.lat,t.execCommand("inserthtml",'<img width="'+d.width+'"height="'+d.height+'" src="'+p+'"'+(i.imgcss?' style="'+i.imgcss+'"':"")+"/>",!0);i.reset()}},cancel:{exec:function(t){t.getWidgetData(e).reset()}}}})}();